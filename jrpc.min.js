// Copyright 2012-2013 St√©phane Lavergne <http://www.imars.com/> Free software under <http://www.gnu.org/licenses/lgpl-3.0.txt>
"use strict";(function(){window.JRPC||(window.JRPC={set_url:function(e){JRPC.u=e},u:"",q:[],c:{},s:0,add:function(e,t,n,s){return JRPC.s++,JRPC.q.push({id:"JRPC_"+JRPC.s,component:e,method:t,args:n}),"function"==typeof s&&(JRPC.c["JRPC_"+JRPC.s]=s),this},run:function(e){var t,n,s=[],o=!1;return window.XMLHttpRequest||window.ActiveXObject?(s=JRPC.q,JRPC.q=[],s.length>0&&(n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),n.open("POST",JRPC.u,!0),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.setRequestHeader("Content-Type","application/json; charset=ISO-8859-1"),t=JSON.stringify({JRPC_Version:2,calls:s}),n.send(t),n.onreadystatechange=function(){var t,i=0,u=null,r="";if(4===n.readyState&&o===!1){o=!0;try{r=n.statusText}catch(c){r=""}try{u=JSON.parse(n.responseText)}catch(R){u=null,r="Response is not valid JSON."}if(n.status>=200&&300>n.status&&null!==u){if(u.JRPC_Version&&2===u.JRPC_Version){for(i=0;u.results.length>i;i++)t=u.results[i],"function"==typeof JRPC.c[t.id]&&JRPC.c[t.id](t.result,t.exception_raised||!1,t.exception||"");"function"==typeof e&&e(!0,"")}else"function"==typeof e&&e(!1,"Invalid JRPC response.");for(i=0;s.length>i;i++)JRPC.c[s[i].id]!==void 0&&delete JRPC.c[s[i].id]}else{for(i=0;s.length>i;i++)JRPC.q.push(s[i]);"function"==typeof e&&e(!1,"error "+r)}}return!0}),void 0):("function"==typeof e&&e(!1,"Browser missing XMLHttpRequest."),null)}})})();